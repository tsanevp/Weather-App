<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="icon" type="image/x-icon" href="images/forcast-favicon.png">
    <link type="text/css" href="css/style.css" rel="stylesheet">
</head>

<body>
    <header class="header" id="navbar">
        <a href="/" class="logo">Weather App</a>

        <nav class="nav-bar">
            <a href="/">Home</a>
            <a href="./about.html">About</a>
            <a href="./contact.html">Contact</a>
        </nav>
    </header>

    <div class="middle-container">
        <h2 id="welcome-msg">Enter Your Location Below To View The Forcast In Your Area!</h2>
        <form id="searchForm">
            <label class="icon-placeholder" for="cityInput">
                <i class='bx bxs-map'></i>
            </label>

            <input id="cityInput" type="text" name="cityName" placeholder="Enter your location" required>

            <button class="icon-placeholder" id="search-button" type="submit" name="button">
                <i class='bx bx-search' id="search-icon"></i>
            </button>
        </form>
        <h3 id="error-msg" class="hidden">There was an error retrieving that location. Please try again.</h3>
    </div>

    <script>
        const form = document.getElementById('searchForm');

        form.addEventListener('submit', (event) => {
            event.preventDefault();
            const formData = new FormData(form);
            const cityName = Object.fromEntries(formData);

            fetch('/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(cityName)
            }).then(response => response.json())
                .then(data => {
                    if (data.invalidLocation) {
                        document.getElementById("error-msg").classList.remove("hidden");
                        return;
                    }
                    console.log(data);
                    // Handle the response from the server
                    document.querySelector("form").classList.add("form-results");
                })
                .catch(error => {
                    console.log("eorror");
                    // Handle any errors
                });;
        });

        document.getElementById("cityInput").addEventListener("click", function() {
            const cityInput = document.getElementById("error-msg");
            if (!cityInput.classList.contains("hidden")) {
                cityInput.classList.add("hidden");
            }
        });

        document.getElementById("search-button").addEventListener("click", function() {
            const welcomeMsg = document.getElementById("welcome-msg");
            if (!welcomeMsg.classList.contains("hidden")) {
                welcomeMsg.classList.add("hidden");
            }
        });
    </script>
</body>

</html>